<h2>{{ action }}</h2>
{{ propertiesDataSource.data | json }}
<div class="image-block">
  <div class="wrapper">
    <img src="{{ imageUrl }}" class="image" alt="Без изображения" #image />
    <div
      class="image-hoverable mat-ripple"
      (click)="selectNewImage()"
      matRipple
    >
      <mat-icon>add_photo_alternate</mat-icon>
    </div>
  </div>
</div>
<button mat-raised-button *ngIf="newImage" (click)="restoreImage()">
  Восстановить прошлую картинку
</button>

<div mat-dialog-content>
  <mat-form-field class="property">
    <input matInput placeholder="Название" [(ngModel)]="productType.name" />
  </mat-form-field>
</div>

<input #selectImage type="file" (change)="onImageSelect($event)" hidden />

<div class="properties">
  <h5>Свойства продукта</h5>
  <table
    mat-table
    [dataSource]="propertiesDataSource"
    class="properties__table"
  >
    <!-- Столбец с именем свойства -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Название свойства</th>

      <td mat-cell *matCellDef="let element">
        <mat-form-field>
          <input matInput [(ngModel)]="element.name">
        </mat-form-field>
      </td>
    </ng-container>

    <!-- Столбец с типом свойства -->
    <ng-container matColumnDef="type">
      <th mat-header-cell *matHeaderCellDef>Тип свойства</th>

      <td mat-cell *matCellDef="let element">
        <mat-form-field>
          <mat-select placeholder="Тип свойства" [(ngModel)]="element.type">
            <mat-option #field *ngFor="let option of allowedTypeValues"
              [value]="option.value">
              {{ option.text }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field *ngIf="element.type == 'Dictionary'" >
          <mat-select placeholder="Справочник" [(ngModel)]="element.dictionary.id">
            <mat-option *ngFor="let dictionary of dictionariesList"
              [value]="dictionary.id">
              {{ dictionary.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </td>
    </ng-container>

    <!-- Столбец с кнопкой удаления -->
    <ng-container matColumnDef="remove">
      <th mat-header-cell *matHeaderCellDef>Действия</th>

      <td mat-cell *matCellDef="let element" class="option-collumn">
        <button mat-icon-button>
          <mat-icon>close</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      class="row"
      *matRowDef="let row; columns: displayedColumns"
    ></tr>
  </table>

  <div class="properties__actions">
    <button mat-raised-button color="primary" (click)="addNewProperty()">
      Новое свойство <mat-icon class="mat-18">add</mat-icon>
    </button>
  </div>
</div>

<div mat-dialog-actions class="actions">
  <button mat-raised-button (click)="close()">Отмена</button>
  <button
    mat-raised-button
    (click)="save()"
    color="primary"
    [disabled]="
      !(
        (inputProductType && inputProductType.name != productType.name) ||
        newImage
      )
    "
  >
    Сохранить
  </button>
</div>
